# Решение задания 2.2

## Анализ проблемы

В ходе анализа витрины `dm.loan_holiday_info` было выявлено, что данные присутствуют только для трех дат:
- 2023-01-01 (3000 записей)
- 2023-03-15 (3500 записей) 
- 2023-08-11 (3502 записи)

Все остальные даты 2023 года (362 дня) отсутствуют в витрине.

## Источники данных

Витрина формируется из трех таблиц:
- `rd.deal_info` - информация по сделкам клиентов
- `rd.loan_holiday` - информация о кредитных каникулах
- `rd.product` - информация о продуктах банка

## Решение

### 1. Анализ данных

Скрипт `task_2_2_solution.py` выполняет анализ текущего состояния данных:
- Определяет диапазон дат в витрине
- Выявляет пропущенные даты
- Анализирует данные в таблицах-источниках

### 2. Загрузка данных

Используется упрощенный способ загрузки данных из CSV файлов с помощью `pandas` и `psycopg2`:
- `data/loan_holiday_info/deal_info.csv` → `rd.deal_info`
- `data/loan_holiday_info/product_info.csv` → `rd.product`

### 3. Процедура пересчета витрины

Создается процедура `refresh_loan_holiday_info()` в файле `refresh_loan_holiday_info.sql`, которая:
- Очищает витрину
- Пересчитывает данные на основе прототипа
- Использует LEFT JOIN для объединения таблиц

### 4. Выбор способа загрузки

**Рекомендуется использовать полную перегрузку таблиц** по следующим причинам:

1. **Целостность данных**: CSV файлы содержат актуальные данные, которые должны полностью заменить существующие
2. **Простота реализации**: Полная перегрузка проще в реализации и отладке
3. **Надежность**: Исключает риск частичного обновления и связанных с ним проблем
4. **Производительность**: Для данных такого объема полная перегрузка будет эффективнее

## Запуск решения

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Убедитесь, что база данных запущена:
```bash
docker-compose up -d
```

3. Запустите основной скрипт:
```bash
python task_2_2_solution.py
```

## Структура файлов

- `task_2_2_solution.py` - основной скрипт решения
- `load_loan_holiday_data.py` - упрощенный скрипт загрузки данных
- `refresh_loan_holiday_info.sql` - процедура пересчета витрины
- `requirements.txt` - зависимости Python
- `TASK_2_2_README.md` - данная документация